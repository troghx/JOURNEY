<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JSC - Personal Obrero</title>
  <link rel="icon" type="image/png" href="journey_no_bg.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
  />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      margin: 0;
      background-color: #03040c;
      color: #f9fafb;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 85% 15%, rgba(255, 212, 96, 0.55), rgba(255, 212, 96, 0) 55%),
        radial-gradient(circle at 12% 80%, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0) 60%);
      pointer-events: none;
      z-index: -2;
    }

    body::after {
      content: '';
      position: fixed;
      inset: -10% -20%;
      background-image:
        radial-gradient(1.2px 1.2px at 20px 35px, rgba(255, 255, 255, 0.9) 45%, transparent 70%),
        radial-gradient(1.2px 1.2px at 80px 120px, rgba(255, 248, 209, 0.85) 45%, transparent 70%),
        radial-gradient(1.2px 1.2px at 140px 60px, rgba(255, 255, 255, 0.8) 45%, transparent 70%),
        radial-gradient(1.2px 1.2px at 30px 160px, rgba(255, 245, 199, 0.75) 45%, transparent 70%),
        radial-gradient(1.2px 1.2px at 160px 190px, rgba(255, 255, 255, 0.85) 45%, transparent 70%);
      background-size: 220px 220px, 240px 240px, 260px 260px, 280px 280px, 300px 300px;
      opacity: 0.75;
      pointer-events: none;
      z-index: -1;
      animation: star-drift 120s linear infinite, star-twinkle 6s ease-in-out infinite;
    }

    @keyframes star-drift {
      from {
        transform: translate3d(0, 0, 0) rotate(0deg);
        background-position: 0 0, 0 0, 0 0, 0 0, 0 0;
      }
      to {
        transform: translate3d(4%, -2%, 0) rotate(360deg);
        background-position: -320px 180px, -260px 140px, -220px 120px, -180px 100px, -140px 80px;
      }
    }

    @keyframes star-twinkle {
      0%,
      100% {
        opacity: 0.55;
      }
      50% {
        opacity: 0.95;
      }
    }

    .glass-panel {
      background: rgba(17, 24, 39, 0.20);
      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.4);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(20px);
    }

    .radial-menu {
      position: fixed;
      top: 0;
      left: 0;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      opacity: 0.82;
      border-radius: 1.25rem;
      pointer-events: none;
      transition: opacity 0.18s ease;
      z-index: 50;
    }

    .radial-menu.active {
      opacity: 1;
      pointer-events: auto;
    }

    .radial-menu .menu-item {
      position: absolute;
      width: 3.2rem;
      height: 3.2rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(17, 24, 39, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 14px 30px rgba(10, 17, 33, 0.32);
      color: #f9fafb;
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 0.68;
      transition: transform 0.22s ease, opacity 0.22s ease, background 0.18s ease, border-color 0.18s ease;
      pointer-events: none;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .radial-menu.active .menu-item {
      opacity: 1;
      pointer-events: auto;
      background: rgba(17, 24, 39, 0.9);
    }

    .radial-menu .menu-item:hover {
      background: rgba(16, 185, 129, 0.92);
      border-color: rgba(16, 185, 129, 0.45);
      color: #022c22;
    }

    .menu-label {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translate(-50%, 0.4rem);
      font-size: 0.65rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: rgba(249, 250, 251, 0.72);
      pointer-events: none;
      white-space: nowrap;
      opacity: 0.82;
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .radial-menu:not(.active) .menu-label {
      opacity: 0;
      transform: translate(-50%, 0.2rem) scale(0.9);
    }

    .radial-menu.active .menu-label {
      opacity: 0.9;
    }

    .radial-menu::after {
      content: '';
      position: absolute;
      width: 3rem;
      height: 3rem;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 9999px;
      background: radial-gradient(circle, rgba(16, 185, 129, 0.18) 0%, rgba(16, 185, 129, 0.04) 58%, rgba(16, 185, 129, 0) 72%);
      box-shadow: 0 0 70px 25px rgba(4, 120, 87, 0.22);
      opacity: 0.38;
      filter: blur(0.5px);
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.25s ease;
    }

    .radial-menu.active::after {
      opacity: 0.65;
      transform: translate(-50%, -50%) scale(1.05);
    }

    .radial-assistive-button {
      --assistive-size: 3.5rem;
      --assistive-border-opacity: 0.16;
      position: fixed;
      right: clamp(1.25rem, 6vw, 2.75rem);
      bottom: clamp(1.25rem, 6vw, 2.75rem);
      width: var(--assistive-size);
      height: var(--assistive-size);
      border-radius: 9999px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.1rem;
      border: 1px solid rgba(255, 255, 255, var(--assistive-border-opacity));
      background: rgba(15, 23, 42, 0.65);
      color: #f9fafb;
      box-shadow: 0 18px 40px rgba(2, 6, 23, 0.45);
      backdrop-filter: blur(22px) saturate(140%);
      -webkit-backdrop-filter: blur(22px) saturate(140%);
      overflow: hidden;
      z-index: 48;
      transition:
        width 0.32s cubic-bezier(0.22, 1, 0.36, 1),
        height 0.32s cubic-bezier(0.22, 1, 0.36, 1),
        border-radius 0.28s ease, box-shadow 0.28s ease,
        background 0.28s ease, border-color 0.28s ease;
      touch-action: none;
      transform-origin: center;
      will-change: left, top, width, height;
    }

    .radial-assistive-button::before {
      content: '';
      position: absolute;
      inset: -45%;
      border-radius: inherit;
      background: conic-gradient(
        from 180deg at 50% 50%,
        rgba(16, 185, 129, 0.55),
        rgba(59, 130, 246, 0.4),
        rgba(244, 114, 182, 0.45),
        rgba(251, 191, 36, 0.42),
        rgba(16, 185, 129, 0.55)
      );
      filter: blur(28px);
      opacity: 0.65;
      transform: rotate(0deg) scale(1.15);
      animation: assistive-haze 12s linear infinite;
      z-index: -1;
    }

    .radial-assistive-button::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.22), transparent 65%),
        radial-gradient(circle at 70% 75%, rgba(96, 165, 250, 0.18), transparent 70%);
      mix-blend-mode: screen;
      opacity: 0.8;
      pointer-events: none;
    }

    .radial-assistive-button svg {
      width: 1.35rem;
      height: 1.35rem;
      transition: opacity 0.24s ease, transform 0.3s ease;
    }

    .radial-assistive-button:focus-visible {
      outline: 2px solid rgba(16, 185, 129, 0.75);
      outline-offset: 4px;
    }

    .radial-assistive-button.is-active {
      --assistive-size: 11rem;
      --assistive-border-opacity: 0.32;
      background: rgba(16, 24, 39, 0.82);
      border-radius: 999px;
      border-color: rgba(16, 185, 129, 0.45);
      box-shadow: 0 28px 60px rgba(6, 16, 40, 0.62);
    }

    .radial-assistive-button.is-dragging {
      transition: none;
    }

    .radial-assistive-button.is-active::before {
      opacity: 0.85;
    }

    .radial-assistive-button.is-active::after {
      opacity: 1;
      filter: saturate(120%);
    }

    .radial-assistive-button.is-active svg {
      opacity: 0;
      transform: scale(0.65);
    }

    @keyframes assistive-haze {
      to {
        transform: rotate(360deg) scale(1.15);
      }
    }

    @media (pointer: coarse) {
      .radial-assistive-button {
        display: flex;
      }
    }
      
    body.coarse-pointer .radial-menu {
      width: min(88vw, 18rem);
      height: auto;
      transform: translate(-50%, calc(-100% - 1.1rem));
      padding: 1rem;
      border-radius: 1.25rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 18px 45px rgba(3, 7, 18, 0.55);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.22s ease, transform 0.22s ease;
    }

    body.coarse-pointer .radial-menu::after {
      display: none;
    }

    body.coarse-pointer .radial-menu.active {
      opacity: 1;
      pointer-events: auto;
    }

    body.coarse-pointer .radial-menu .menu-item {
      position: relative;
      width: 100%;
      height: auto;
      transform: none !important;
      opacity: 1 !important;
      background: rgba(15, 23, 42, 0.65);
      border-radius: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 0.85rem 1rem;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.75rem;
      pointer-events: auto;
      text-align: left;
      transition: background 0.18s ease, border-color 0.18s ease, color 0.18s ease;
    }

    body.coarse-pointer .radial-menu .menu-item:hover,
    body.coarse-pointer .radial-menu .menu-item:focus-visible {
      background: rgba(16, 185, 129, 0.18);
      border-color: rgba(16, 185, 129, 0.45);
      color: #ecfdf5;
      outline: none;
    }

    body.coarse-pointer .radial-menu .menu-item svg {
      width: 1.2rem;
      height: 1.2rem;
      flex-shrink: 0;
    }

    body.coarse-pointer .radial-menu .menu-label {
      position: static;
      top: auto;
      left: auto;
      transform: none;
      font-size: 0.95rem;
      letter-spacing: 0.02em;
      text-transform: none;
      opacity: 0.92;
      pointer-events: none;
      white-space: normal;
      line-height: 1.35;
      flex: 1;
    }

    body.coarse-pointer .radial-menu .menu-item .menu-label {
      margin: 0;
    }

    .search-panel {
      position: fixed;
      top: 8rem;
      right: clamp(1.5rem, 4vw, 3.75rem);
      width: min(90vw, 24rem);
      z-index: 40;
      opacity: 0;
      transform: translateY(1rem);
      transition: opacity 0.24s ease, transform 0.24s ease;
      pointer-events: none;
    }

    .search-panel.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .search-card {
      border-radius: 1.75rem;
      padding: 1.75rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .search-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .search-card-header h2 {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
      color: #f9fafb;
    }

    .close-search-button {
      appearance: none;
      border: none;
      border-radius: 9999px;
      background: rgba(255, 255, 255, 0.08);
      color: rgba(249, 250, 251, 0.78);
      width: 2.25rem;
      height: 2.25rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.18s ease, color 0.18s ease;
    }

    .close-search-button:hover {
      background: rgba(248, 250, 252, 0.18);
      color: #0f172a;
    }

    .search-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      text-align: left;
    }

    .search-input-label {
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: rgba(249, 250, 251, 0.56);
    }

    .search-input-field {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-radius: 9999px;
      padding: 0.9rem 1.2rem;
      background: rgba(15, 23, 42, 0.78);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.06);
    }

    .search-input-field svg {
      width: 1rem;
      height: 1rem;
      flex-shrink: 0;
      color: rgba(148, 163, 184, 0.8);
    }

    .search-input-field input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: #f9fafb;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .search-input-field input::placeholder {
      color: rgba(148, 163, 184, 0.6);
    }

    .worker-results {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .worker-helper {
      margin: 0 auto;
      max-width: 22rem;
      text-align: center;
      font-size: 0.85rem;
      line-height: 1.5;
      color: rgba(226, 232, 240, 0.72);
    }

    .worker-helper--loading {
      color: rgba(125, 211, 252, 0.82);
    }

    .worker-helper--error {
      color: rgba(248, 113, 113, 0.82);
    }

    .worker-helper--empty {
      color: rgba(203, 213, 225, 0.72);
    }

    .worker-result-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.25rem;
      padding: 1.8rem;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 24px 48px rgba(15, 23, 42, 0.42);
      position: relative;
      overflow: hidden;
      border-radius: 1.25rem;
      text-align: center;
    }

    .worker-result-card[data-status='active'] {
      box-shadow: 0 24px 54px rgba(16, 185, 129, 0.18);
    }

    .worker-result-card[data-status='inactive'] {
      box-shadow: 0 24px 54px rgba(248, 113, 113, 0.18);
    }

    .worker-result-card[data-status='suspended'] {
      box-shadow: 0 24px 54px rgba(251, 191, 36, 0.22);
    }

    .worker-avatar {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem;
      border-radius: 2rem;
    }

    .worker-avatar::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      filter: blur(18px);
      opacity: 0.7;
      transition: opacity 200ms ease, transform 200ms ease;
      transform: scale(0.9);
      z-index: 0;
    }

    .worker-avatar[data-status='active']::before {
      background: radial-gradient(circle, rgba(16, 185, 129, 0.8), rgba(16, 185, 129, 0.08));
    }

    .worker-avatar[data-status='inactive']::before {
      background: radial-gradient(circle, rgba(248, 113, 113, 0.85), rgba(248, 113, 113, 0.1));
    }

    .worker-avatar[data-status='unknown']::before {
      background: radial-gradient(circle, rgba(59, 130, 246, 0.75), rgba(59, 130, 246, 0.08));
    }

    .worker-avatar[data-status='suspended']::before {
      background: radial-gradient(circle, rgba(251, 191, 36, 0.85), rgba(251, 191, 36, 0.12));
    }

    .worker-result-card:hover .worker-avatar::before {
      opacity: 0.95;
      transform: scale(1);
    }

    .worker-visual {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .worker-photo-wrapper {
      position: relative;
    }

    .worker-photo {
      position: relative;
      width: 6rem;
      height: 6rem;
      border-radius: 1.5rem;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.32), rgba(14, 116, 144, 0.18));
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(4, 47, 46, 0.78);
      font-weight: 600;
      font-size: 1.5rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      overflow: hidden;
      z-index: 1;
      transition: transform 200ms ease, box-shadow 200ms ease;
    }

    .worker-photo::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.25);
      opacity: 0.45;
      pointer-events: none;
      transition: opacity 200ms ease;
    }

    .worker-photo.has-image::after {
      opacity: 0.7;
    }

    .worker-photo-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .worker-photo-initials {
      z-index: 1;
      transition: opacity 200ms ease;
    }

    .worker-photo.has-image .worker-photo-initials {
      opacity: 0;
    }

    .worker-photo-upload-button {
      position: absolute;
      bottom: -0.65rem;
      left: 50%;
      transform: translateX(-50%);
      width: 2.2rem;
      height: 2.2rem;
      border-radius: 9999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.92);
      border: 2px solid rgba(148, 163, 184, 0.5);
      color: #f9fafb;
      cursor: pointer;
      transition: background 200ms ease, color 200ms ease, border-color 200ms ease, transform 200ms ease;
      box-shadow: 0 10px 18px rgba(15, 23, 42, 0.38);
      z-index: 2;
    }

    .worker-photo-upload-button:hover {
      background: rgba(16, 185, 129, 0.9);
      border-color: rgba(110, 231, 183, 0.6);
      color: rgba(2, 44, 34, 0.92);
      transform: translateX(-50%) translateY(-1px);
    }

    .worker-photo-upload-button svg {
      width: 1rem;
      height: 1rem;
    }

    .worker-photo-input {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .worker-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      min-width: 0;
    }

    .worker-info h3 {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 600;
      color: #f9fafb;
      text-align: center;
    }

    .worker-status-pill {
      border: none;
      padding: 0.45rem 1.1rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 600;
      color: rgba(15, 23, 42, 0.92);
      background: rgba(255, 255, 255, 0.85);
      cursor: pointer;
      transition: transform 160ms ease, box-shadow 160ms ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
    }

    .worker-status-pill:focus-visible {
      outline: 2px solid rgba(110, 231, 183, 0.7);
      outline-offset: 2px;
    }

    .worker-status-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.32);
    }

    .worker-status-pill[data-status='active'] {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.92), rgba(110, 231, 183, 0.88));
      color: rgba(2, 44, 34, 0.92);
    }

    .worker-status-pill[data-status='inactive'] {
      background: linear-gradient(135deg, rgba(248, 113, 113, 0.92), rgba(254, 202, 202, 0.9));
      color: rgba(76, 5, 25, 0.92);
    }

    .worker-status-pill[data-status='unknown'] {
      background: linear-gradient(135deg, rgba(96, 165, 250, 0.92), rgba(191, 219, 254, 0.9));
      color: rgba(17, 24, 39, 0.92);
    }

    .worker-status-pill[data-status='suspended'] {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.92), rgba(254, 240, 138, 0.9));
      color: rgba(63, 35, 0, 0.92);
    }

    .worker-meta {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: rgba(226, 232, 240, 0.82);
      text-align: left;
      width: 100%;
    }

    .worker-meta-item {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
      word-break: break-word;
    }

    .worker-meta-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.92);
    }

    .worker-status-note {
      font-size: 0.75rem;
      color: rgba(253, 230, 138, 0.9);
      background: rgba(250, 204, 21, 0.12);
      padding: 0.4rem 0.9rem;
      border-radius: 9999px;
      font-weight: 500;
      text-align: center;
    }

    body.modal-open {
      overflow: hidden;
    }

    .status-change-modal {
      position: fixed;
      inset: 0;
      background: rgba(3, 7, 18, 0.72);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 60;
      opacity: 0;
      visibility: hidden;
      transition: opacity 200ms ease, visibility 200ms ease;
    }

    .status-change-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .status-change-card {
      width: min(100%, 26rem);
      border-radius: 1.5rem;
    }

    .status-modal-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
      color: #f9fafb;
    }

    .status-modal-description {
      font-size: 0.85rem;
      color: rgba(226, 232, 240, 0.75);
      margin-bottom: 1.25rem;
    }

    .status-option-group {
      display: grid;
      gap: 0.75rem;
    }

    .status-option-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.5);
      color: rgba(226, 232, 240, 0.9);
      font-weight: 600;
      cursor: pointer;
      transition: border-color 200ms ease, background 200ms ease, transform 200ms ease, color 200ms ease;
    }

    .status-option-button:hover {
      border-color: rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.62);
    }

    .status-option-button[aria-pressed='true'] {
      transform: translateY(-1px);
      border-color: rgba(110, 231, 183, 0.6);
      background: rgba(16, 185, 129, 0.18);
      color: rgba(237, 255, 250, 0.95);
    }

    .status-option-button[data-status-option='inactive'][aria-pressed='true'] {
      border-color: rgba(248, 113, 113, 0.6);
      background: rgba(248, 113, 113, 0.18);
      color: rgba(255, 241, 242, 0.95);
    }

    .status-option-button[data-status-option='suspended'][aria-pressed='true'] {
      border-color: rgba(251, 191, 36, 0.65);
      background: rgba(251, 191, 36, 0.2);
      color: rgba(60, 33, 0, 0.95);
    }

    .status-option-label {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.2rem;
    }

    .status-option-caption {
      font-size: 0.65rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 600;
      opacity: 0.72;
    }

    .status-option-button[data-status-option='active'] .status-option-caption {
      color: rgba(110, 231, 183, 0.85);
    }

    .status-option-button[data-status-option='suspended'] .status-option-caption {
      color: rgba(253, 230, 138, 0.85);
    }

    .status-option-button[data-status-option='inactive'] .status-option-caption {
      color: rgba(254, 202, 202, 0.85);
    }

    .status-reason-field {
      display: grid;
      gap: 0.35rem;
      margin-top: 0.75rem;
    }

    .status-reason-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(226, 232, 240, 0.75);
      font-weight: 600;
    }

    .status-reason-textarea {
      resize: vertical;
      min-height: 4rem;
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.45);
      color: #f9fafb;
      padding: 0.75rem;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .status-reason-textarea:focus {
      outline: none;
      border-color: rgba(110, 231, 183, 0.6);
      box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.35);
    }

    .status-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .status-modal-actions button {
      border-radius: 9999px;
      padding: 0.55rem 1.35rem;
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: background 200ms ease, color 200ms ease, opacity 200ms ease;
    }

    .status-cancel-button {
      background: rgba(148, 163, 184, 0.15);
      color: rgba(226, 232, 240, 0.9);
    }

    .status-cancel-button:hover {
      background: rgba(148, 163, 184, 0.25);
    }

    .status-confirm-button {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(110, 231, 183, 0.85));
      color: rgba(2, 44, 34, 0.92);
      box-shadow: 0 16px 30px rgba(16, 185, 129, 0.25);
    }

    .status-confirm-button:hover:not(:disabled) {
      box-shadow: 0 20px 36px rgba(16, 185, 129, 0.32);
    }

    .status-confirm-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: none;
    }

    @media (max-width: 640px) {
      .search-panel {
        top: auto;
        bottom: 1.5rem;
        left: 50%;
        right: auto;
        transform: translate(-50%, 1.5rem);
      }

      .search-panel.active {
        transform: translate(-50%, 0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body class="relative flex flex-col items-center justify-start px-4 sm:px-6 py-12 sm:py-16">
  <a
    href="seleccionar_personal.html"
    class="absolute left-6 top-6 inline-flex items-center text-sm font-medium text-white/70 transition hover:text-white"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
    Volver
  </a>

  <header class="glass-panel mt-20 sm:mt-24 w-full max-w-3xl rounded-3xl px-6 py-8 sm:px-8 sm:py-10 text-center">
    <p class="text-sm font-medium uppercase tracking-[0.3em] text-white/60">Personal Obrero</p>
    <h1 class="mt-4 text-3xl font-semibold text-white">
      Bienvenido <span id="welcome-name" class="text-emerald-200"></span>
    </h1>
    <p class="mt-2 text-lg text-white/80">¿Qué haremos hoy?</p>
  </header>

  <section class="mt-10 sm:mt-14 w-full max-w-4xl">
    <div class="glass-panel rounded-3xl px-6 py-8 sm:px-8 sm:py-10 text-center">
      <p class="text-base text-white/70">
        Explora las acciones disponibles con el menú radial. Haz clic derecho en cualquier parte de la pantalla para descubrir herramientas rápidas
        como búsqueda de personal, alta de colaboradores o la consulta de reportes generados.
      </p>
      <p class="mt-6 text-sm text-white/40">Tip: puedes cerrar el menú radial haciendo clic fuera de él o presionando la tecla Escape.</p>
    </div>
  </section>

  <div id="radial-menu" class="radial-menu" aria-hidden="true">
    <button type="button" class="menu-item" data-action="buscar-personal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
        <circle cx="11" cy="11" r="7" />
        <line x1="20" y1="20" x2="16.65" y2="16.65" />
      </svg>
      <span class="menu-label">Buscar personal</span>
    </button>
    <button type="button" class="menu-item" data-action="registrar-personal">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
        <path d="M12 5a4 4 0 110 8 4 4 0 010-8z" />
        <path d="M20 21a8 8 0 10-16 0" />
        <line x1="19" y1="8" x2="19" y2="14" />
        <line x1="16" y1="11" x2="22" y2="11" />
      </svg>
      <span class="menu-label">Registrar personal</span>
    </button>
    <button type="button" class="menu-item" data-action="buscar-reportes">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
        <path d="M9 3h6a2 2 0 012 2v14l-5-3-5 3V5a2 2 0 012-2z" />
      </svg>
      <span class="menu-label">Reportes</span>
    </button>
  </div>

  <button
    id="radial-assistive-button"
    class="radial-assistive-button"
    type="button"
    aria-label="Abrir menú rápido"
    aria-haspopup="true"
    aria-expanded="false"
    aria-controls="radial-menu"
    aria-hidden="true"
  >
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
      <circle cx="12" cy="12" r="2.2" />
      <circle cx="5.5" cy="12" r="1.6" />
      <circle cx="18.5" cy="12" r="1.6" />
    </svg>
  </button>

  <div id="search-panel" class="search-panel" aria-hidden="true">
    <div class="search-card glass-panel" role="dialog" aria-labelledby="search-panel-title">
      <div class="search-card-header">
        <h2 id="search-panel-title">Buscar trabajador</h2>
        <button type="button" class="close-search-button" id="close-search-panel" aria-label="Cerrar búsqueda">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <line x1="6" y1="6" x2="18" y2="18" />
            <line x1="18" y1="6" x2="6" y2="18" />
          </svg>
        </button>
      </div>
      <label class="search-input-wrapper" for="worker-search-input">
        <span class="search-input-label">Busca por nombre, NSS o CURP</span>
        <div class="search-input-field">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <circle cx="11" cy="11" r="7" />
            <line x1="20" y1="20" x2="16.65" y2="16.65" />
          </svg>
          <input
            id="worker-search-input"
            type="text"
            placeholder="Escribe nombre, NSS o CURP"
            autocomplete="off"
          />
        </div>
      </label>
      <div id="worker-search-results" class="worker-results" aria-live="polite">
        <p class="worker-helper">Escribe el nombre del trabajador para iniciar la búsqueda.</p>
      </div>
    </div>
  </div>

  <div
    id="status-change-modal"
    class="status-change-modal"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
  >
    <div class="status-change-card glass-panel p-6">
      <h2 id="status-modal-title" class="status-modal-title">Actualizar estatus</h2>
      <p id="status-modal-description" class="status-modal-description">
        Selecciona el nuevo estatus para el trabajador.
      </p>
      <div class="status-option-group" role="group" aria-labelledby="status-modal-title">
        <button type="button" class="status-option-button" data-status-option="active" aria-pressed="false">
          <span class="status-option-label">
            <span>Activo</span>
            <span class="status-option-caption">Disponible</span>
          </span>
        </button>
        <button type="button" class="status-option-button" data-status-option="suspended" aria-pressed="false">
          <span class="status-option-label">
            <span>Suspensión</span>
            <span class="status-option-caption">Temporal</span>
          </span>
        </button>
        <button type="button" class="status-option-button" data-status-option="inactive" aria-pressed="false">
          <span class="status-option-label">
            <span>Baja</span>
            <span class="status-option-caption">Definitiva</span>
          </span>
        </button>
      </div>
      <div id="status-reason-field" class="status-reason-field" hidden>
        <span class="status-reason-label">Motivo de suspensión</span>
        <textarea
          id="status-reason-input"
          class="status-reason-textarea"
          placeholder="Describe brevemente el motivo"
        ></textarea>
      </div>
      <div class="status-modal-actions">
        <button type="button" class="status-cancel-button" data-status-cancel>Cancelar</button>
        <button type="button" class="status-confirm-button" data-status-confirm disabled>Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    const username = localStorage.getItem('jscUserName') || 'Equipo JSC';
    const nameTarget = document.getElementById('welcome-name');
    if (nameTarget) {
      nameTarget.textContent = username;
    }

    const radialMenu = document.getElementById('radial-menu');
    const menuItems = Array.from(radialMenu.querySelectorAll('.menu-item'));
    const assistiveButton = document.getElementById('radial-assistive-button');
    const coarsePointerQuery = window.matchMedia('(pointer: coarse)');
    const searchPanel = document.getElementById('search-panel');
    const closeSearchPanelButton = document.getElementById('close-search-panel');
    const searchInput = document.getElementById('worker-search-input');
    const workerResultsContainer = document.getElementById('worker-search-results');

    const statusChangeModal = document.getElementById('status-change-modal');
    const statusModalDescription = document.getElementById('status-modal-description');
    const statusOptionButtons = statusChangeModal
      ? Array.from(statusChangeModal.querySelectorAll('[data-status-option]'))
      : [];
    const statusReasonField = document.getElementById('status-reason-field');
    const statusReasonInput = document.getElementById('status-reason-input');
    const statusConfirmButton = statusChangeModal?.querySelector('[data-status-confirm]') ?? null;
    const statusCancelButton = statusChangeModal?.querySelector('[data-status-cancel]') ?? null;

    const normalizeValue = (value) =>
      value
        ? value
            .toString()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .toLowerCase()
            .trim()
        : '';

    const cleanDisplayValue = (value) =>
      value ? value.toString().replace(/\*/g, '').replace(/\s+/g, ' ').trim() : 'Sin dato';

    const workerDatasetState = {
      data: [],
      promise: null,
      error: null,
    };

    const STATUS_LABELS = {
      active: 'Activo',
      inactive: 'Baja',
      suspended: 'Suspensión',
      unknown: 'Sin información',
    };

    const statusModalState = {
      card: null,
      avatar: null,
      statusButton: null,
      statusNote: null,
      workerName: '',
      selectedStatus: null,
      reason: '',
    };

    const showHelperMessage = (text, modifier) => {
      if (!workerResultsContainer) return;
      const message = document.createElement('p');
      message.className = 'worker-helper';
      if (modifier) {
        message.classList.add(`worker-helper--${modifier}`);
      }
      message.textContent = text;
      workerResultsContainer.replaceChildren(message);
    };

    const getWorkerInitials = (name) => {
      if (!name) return 'OB';
      const sanitized = name.replace(/,/g, ' ');
      const parts = sanitized
        .split(/\s+/)
        .filter(Boolean)
        .slice(0, 3);
      if (parts.length === 0) return 'OB';
      const initials = parts
        .slice(0, 2)
        .map((part) => part[0] ?? '')
        .join('');
      return initials ? initials.toUpperCase() : parts[0][0].toUpperCase();
    };

    const createMetaItem = (label, value) => {
      const item = document.createElement('li');
      item.className = 'worker-meta-item';
      const labelElement = document.createElement('span');
      labelElement.className = 'worker-meta-label';
      labelElement.textContent = `${label}:`;
      const valueText = document.createElement('span');
      valueText.textContent = cleanDisplayValue(value) || 'Sin dato';
      item.append(labelElement, valueText);
      return item;
    };

    const getStatusLabel = (statusKey, fallbackLabel = STATUS_LABELS.unknown) =>
      statusKey && STATUS_LABELS[statusKey] ? STATUS_LABELS[statusKey] : fallbackLabel;

    const updateStatusConfirmState = () => {
      if (!statusConfirmButton) return;
      if (!statusModalState.selectedStatus) {
        statusConfirmButton.disabled = true;
        return;
      }

      if (statusModalState.selectedStatus === 'suspended') {
        const reasonText = statusReasonInput?.value.trim() ?? '';
        statusConfirmButton.disabled = reasonText.length === 0;
        return;
      }

      statusConfirmButton.disabled = false;
    };

    const setStatusModalSelection = (statusKey) => {
      statusModalState.selectedStatus = statusKey || null;
      statusOptionButtons.forEach((button) => {
        const isSelected = statusKey && button.dataset.statusOption === statusKey;
        button.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
      });

      const requiresReason = statusModalState.selectedStatus === 'suspended';
      if (statusReasonField) {
        statusReasonField.hidden = !requiresReason;
      }

      if (requiresReason && statusReasonInput) {
        statusReasonInput.value = statusModalState.reason;
        setTimeout(() => {
          statusReasonInput.focus({ preventScroll: true });
        }, 80);
      }

      updateStatusConfirmState();
    };

    const closeStatusChangeModal = () => {
      if (!statusChangeModal?.classList.contains('active')) return;
      statusChangeModal.classList.remove('active');
      statusChangeModal.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('modal-open');
      statusModalState.card = null;
      statusModalState.avatar = null;
      statusModalState.statusButton = null;
      statusModalState.statusNote = null;
      statusModalState.workerName = '';
      statusModalState.selectedStatus = null;
      statusModalState.reason = '';
      statusOptionButtons.forEach((button) => button.setAttribute('aria-pressed', 'false'));
      if (statusReasonInput) {
        statusReasonInput.value = '';
      }
      if (statusReasonField) {
        statusReasonField.hidden = true;
      }
      updateStatusConfirmState();
    };

    const openStatusChangeModal = (context) => {
      if (!statusChangeModal) return;

      statusModalState.card = context.card;
      statusModalState.avatar = context.avatar;
      statusModalState.statusButton = context.statusButton;
      statusModalState.statusNote = context.statusNote;
      statusModalState.workerName = context.workerName;
      const selectableStatuses = ['active', 'inactive', 'suspended'];
      const initialStatus = selectableStatuses.includes(context.currentStatus)
        ? context.currentStatus
        : null;
      statusModalState.selectedStatus = initialStatus;
      statusModalState.reason = context.card.dataset.suspensionReason || '';

      if (statusModalDescription) {
        const currentLabel = getStatusLabel(context.currentStatus, STATUS_LABELS.unknown);
        statusModalDescription.textContent = `Selecciona el nuevo estatus para ${context.workerName}. (Actual: ${currentLabel})`;
      }

      if (statusReasonInput) {
        statusReasonInput.value = statusModalState.reason;
      }

      statusChangeModal.classList.add('active');
      statusChangeModal.setAttribute('aria-hidden', 'false');
      document.body.classList.add('modal-open');
      setStatusModalSelection(initialStatus);
    };

    const applyStatusChange = () => {
      if (
        !statusModalState.card ||
        !statusModalState.avatar ||
        !statusModalState.statusButton ||
        !statusModalState.selectedStatus
      ) {
        return;
      }

      const newStatus = statusModalState.selectedStatus;
      const reasonText =
        newStatus === 'suspended' ? (statusReasonInput?.value.trim() ?? '') : '';
      const label = getStatusLabel(newStatus, STATUS_LABELS.unknown);

      statusModalState.card.dataset.status = newStatus;
      statusModalState.avatar.dataset.status = newStatus;
      statusModalState.statusButton.dataset.status = newStatus;
      statusModalState.statusButton.textContent = label;
      statusModalState.statusButton.setAttribute(
        'aria-label',
        `Cambiar estatus de ${statusModalState.workerName} (actual: ${label})`
      );

      if (newStatus === 'suspended') {
        statusModalState.card.dataset.suspensionReason = reasonText;
        if (statusModalState.statusNote) {
          statusModalState.statusNote.textContent = reasonText
            ? `Motivo: ${reasonText}`
            : 'Motivo no especificado';
          statusModalState.statusNote.hidden = false;
        }
      } else {
        delete statusModalState.card.dataset.suspensionReason;
        if (statusModalState.statusNote) {
          statusModalState.statusNote.textContent = '';
          statusModalState.statusNote.hidden = true;
        }
      }

      closeStatusChangeModal();
    };

    const isStatusModalOpen = () => statusChangeModal?.classList.contains('active');

    const createWorkerCard = (worker) => {
      const rawStatus = worker['Sigue en obra'];
      const statusValue = normalizeValue(rawStatus);
      let statusKey = 'unknown';

      if (statusValue === 'si') {
        statusKey = 'active';
      } else if (statusValue === 'no') {
        statusKey = 'inactive';
      } else if (statusValue.startsWith('susp')) {
        statusKey = 'suspended';
      }

      let statusLabel = getStatusLabel(statusKey);
      if (statusKey === 'unknown' && rawStatus) {
        statusLabel = cleanDisplayValue(rawStatus);
      }

      const card = document.createElement('article');
      card.className = 'worker-result-card';
      card.dataset.status = statusKey;

      const visual = document.createElement('div');
      visual.className = 'worker-visual';

      const avatar = document.createElement('div');
      avatar.className = 'worker-avatar';
      avatar.dataset.status = statusKey;

      const photoWrapper = document.createElement('div');
      photoWrapper.className = 'worker-photo-wrapper';

      const photoContainer = document.createElement('div');
      photoContainer.className = 'worker-photo';

      const photoImage = document.createElement('img');
      photoImage.className = 'worker-photo-image';
      photoImage.alt = `Foto de ${worker.Nombre || 'trabajador'}`;
      photoImage.hidden = true;

      const photoInitials = document.createElement('span');
      photoInitials.className = 'worker-photo-initials';
      photoInitials.textContent = getWorkerInitials(worker.Nombre);

      photoContainer.append(photoImage, photoInitials);

      const uploadButton = document.createElement('button');
      uploadButton.type = 'button';
      uploadButton.className = 'worker-photo-upload-button';
      uploadButton.setAttribute('aria-label', 'Actualizar foto del trabajador');
      uploadButton.title = 'Cambiar foto';
      uploadButton.innerHTML =
        '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9" /><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z" /></svg>';

      const photoInput = document.createElement('input');
      photoInput.type = 'file';
      photoInput.accept = 'image/*';
      photoInput.className = 'worker-photo-input';

      uploadButton.addEventListener('click', (event) => {
        event.preventDefault();
        photoInput.click();
      });

      photoInput.addEventListener('change', (event) => {
        const [file] = event.target.files ?? [];
        if (!file) return;
        if (file.type && !file.type.startsWith('image/')) {
          console.warn('El archivo seleccionado no es una imagen.');
          event.target.value = '';
          return;
        }

        const reader = new FileReader();
        reader.addEventListener('load', () => {
          const result = reader.result;
          if (typeof result === 'string') {
            photoImage.src = result;
            photoImage.hidden = false;
            photoContainer.classList.add('has-image');
          }
        });
        reader.addEventListener('error', (errorEvent) => {
          console.error('No se pudo cargar la imagen seleccionada.', errorEvent);
        });
        reader.readAsDataURL(file);
        event.target.value = '';
      });

      photoWrapper.append(photoContainer, uploadButton, photoInput);
      avatar.appendChild(photoWrapper);
      visual.appendChild(avatar);

      const info = document.createElement('div');
      info.className = 'worker-info';

      const nameHeading = document.createElement('h3');
      nameHeading.textContent = worker.Nombre || 'Sin nombre';
      info.appendChild(nameHeading);

      const statusButton = document.createElement('button');
      statusButton.type = 'button';
      statusButton.className = 'worker-status-pill';
      statusButton.dataset.status = statusKey;
      statusButton.textContent = statusLabel;
      statusButton.setAttribute(
        'aria-label',
        `Cambiar estatus de ${worker.Nombre || 'trabajador'} (actual: ${statusLabel})`
      );
      info.appendChild(statusButton);

      const statusNote = document.createElement('p');
      statusNote.className = 'worker-status-note';
      statusNote.hidden = true;
      info.appendChild(statusNote);

      const metaList = document.createElement('ul');
      metaList.className = 'worker-meta';
      metaList.append(
        createMetaItem('NSS', worker.NSS),
        createMetaItem('CURP', worker.CURP),
        createMetaItem('Empresa', worker.Empresa_Edit || worker.Empresa)
      );
      info.appendChild(metaList);

      card.append(visual, info);

      statusButton.addEventListener('click', (event) => {
        event.preventDefault();
        openStatusChangeModal({
          card,
          avatar,
          statusButton,
          statusNote,
          workerName: worker.Nombre || 'Sin nombre',
          currentStatus: statusButton.dataset.status || 'unknown',
        });
      });

      return card;
    };

    const ensureWorkerDataset = () => {
      if (workerDatasetState.data.length > 0) {
        return Promise.resolve(workerDatasetState.data);
      }

      if (workerDatasetState.promise) {
        return workerDatasetState.promise;
      }

      showHelperMessage('Cargando base de datos de personal...', 'loading');
      workerDatasetState.error = null;
      workerDatasetState.promise = fetch('data/personal_unicos.min.json')
        .then((response) => {
          if (!response.ok) {
            throw new Error(`No se pudo cargar el catálogo (estatus ${response.status})`);
          }
          return response.text();
        })
        .then((text) => {
          const sanitized = text.replace(/\bNaN\b/g, 'null');
          const parsed = JSON.parse(sanitized);
          const workers = parsed.filter(
            (person) => normalizeValue(person.Tipo) === 'obrero'
          );
          workers.sort((a, b) => (a.Nombre || '').localeCompare(b.Nombre || '', 'es', {
            sensitivity: 'base',
          }));
          workerDatasetState.data = workers.map((worker) => ({
            ...worker,
            _searchText: [
              worker.Nombre,
              worker.NSS,
              worker.CURP,
              worker.Empresa,
              worker.Empresa_Edit,
              worker.Cliente,
              worker.q,
            ]
              .filter(Boolean)
              .map((value) => normalizeValue(value))
              .join(' '),
          }));
          workerDatasetState.error = null;
          return workerDatasetState.data;
        })
        .catch((error) => {
          workerDatasetState.error = error;
          console.error('Error al cargar la base de datos de personal:', error);
          showHelperMessage('No se pudo cargar la base de datos. Intenta de nuevo.', 'error');
          throw error;
        })
        .finally(() => {
          workerDatasetState.promise = null;
        });

      return workerDatasetState.promise;
    };

    const updateSearchResults = (rawQuery) => {
      if (!workerResultsContainer) return;

      const trimmedQuery = rawQuery.trim();
      if (!trimmedQuery) {
        showHelperMessage('Escribe el nombre del trabajador para iniciar la búsqueda.');
        return;
      }

      const normalizedQuery = normalizeValue(trimmedQuery);
      if (!normalizedQuery) {
        showHelperMessage('Escribe el nombre del trabajador para iniciar la búsqueda.');
        return;
      }

      const matches = workerDatasetState.data
        .map((worker) => ({
          worker,
          score: worker._searchText.indexOf(normalizedQuery),
        }))
        .filter(({ score }) => score !== -1)
        .sort((a, b) => {
          if (a.score === b.score) {
            return (a.worker.Nombre || '').localeCompare(b.worker.Nombre || '', 'es', {
              sensitivity: 'base',
            });
          }
          return a.score - b.score;
        })
        .slice(0, 6)
        .map(({ worker }) => worker);

      if (matches.length === 0) {
        showHelperMessage('No encontramos coincidencias para tu búsqueda.', 'empty');
        return;
      }

      const fragment = document.createDocumentFragment();
      matches.forEach((worker) => {
        fragment.appendChild(createWorkerCard(worker));
      });
      workerResultsContainer.replaceChildren(fragment);
    };

    const clamp = (value, min, max) => Math.min(Math.max(value, min), max);

    const pointer = {
      x: window.innerWidth / 2,
      y: window.innerHeight / 2,
    };

    let isMenuOpen = false;
    let frameHandle = null;
    const IDLE_RADIUS = 35;
    const ACTIVE_RADIUS = 88;
    const IDLE_SCALE = 0.55;
    const ACTIVE_SCALE = 1;
    const IDLE_OPACITY = 0.60;
    const ACTIVE_OPACITY = 1;

    const isCoarsePointer = () => coarsePointerQuery.matches;

    const assistiveButtonPosition = {
      x: window.innerWidth - 80,
      y: window.innerHeight - 80,
    };

    const assistiveButtonRestPosition = {
      x: assistiveButtonPosition.x,
      y: assistiveButtonPosition.y,
    };

    let isDraggingAssistiveButton = false;
    let didDragAssistiveButton = false;
    let skipNextAssistiveClick = false;
    const assistiveDragOffset = { x: 0, y: 0 };
    const assistiveDragStart = { x: 0, y: 0 };

    const syncAssistiveButtonState = (coarse = isCoarsePointer()) => {
      if (!assistiveButton) return;
      assistiveButton.classList.toggle('is-active', coarse && isMenuOpen);
      assistiveButton.setAttribute('aria-hidden', coarse ? 'false' : 'true');
      assistiveButton.setAttribute('aria-expanded', coarse && isMenuOpen ? 'true' : 'false');
      assistiveButton.tabIndex = coarse ? 0 : -1;
      requestAnimationFrame(() => {
        updateAssistiveButtonPosition(assistiveButtonPosition.x, assistiveButtonPosition.y, {
          updateRest: !isMenuOpen,
        });
      });
    };

    const isSearchPanelOpen = () => searchPanel?.classList.contains('active');

    const applyMenuLayout = (radius, scale, opacity) => {
      if (isCoarsePointer()) {
        menuItems.forEach((item) => {
          item.style.transform = '';
          item.style.opacity = '';
        });
        return;
      }

      const angleStep = (Math.PI * 2) / menuItems.length;
      menuItems.forEach((item, index) => {
        const angle = angleStep * index - Math.PI / 2;
        const x = radius * Math.cos(angle);
        const y = radius * Math.sin(angle);
        item.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) scale(${scale})`;
        item.style.opacity = opacity;
      });
    };

    const renderMenu = () => {
      frameHandle = null;
      radialMenu.style.left = `${pointer.x}px`;
      radialMenu.style.top = `${pointer.y}px`;
      const radius = isMenuOpen ? ACTIVE_RADIUS : IDLE_RADIUS;
      const scale = isMenuOpen ? ACTIVE_SCALE : IDLE_SCALE;
      const opacity = isMenuOpen ? ACTIVE_OPACITY : IDLE_OPACITY;
      applyMenuLayout(radius, scale, opacity);
    };

    const scheduleRender = () => {
      if (frameHandle !== null) return;
      frameHandle = requestAnimationFrame(renderMenu);
    };

    const setMenuState = (open) => {
      if (open === isMenuOpen) {
        scheduleRender();
        return;
      }

      isMenuOpen = open;
      radialMenu.classList.toggle('active', isMenuOpen);
      radialMenu.setAttribute('aria-hidden', isMenuOpen ? 'false' : 'true');
      syncAssistiveButtonState();
      if (isMenuOpen) {
        if (isCoarsePointer()) {
          updatePointerFromAssistiveButton();
        }
      } else {
        if (!isCoarsePointer()) {
          updateAssistiveButtonPosition(assistiveButtonRestPosition.x, assistiveButtonRestPosition.y);
        }
        updatePointerFromAssistiveButton();
      }
      scheduleRender();
    };

    const closeRadialMenu = () => {
      if (!isMenuOpen) return;
      setMenuState(false);
    };

    const getAssistiveBoundaries = () => {
      if (!assistiveButton) {
        return {
          minX: 40,
          maxX: window.innerWidth - 40,
          minY: 40,
          maxY: window.innerHeight - 40,
        };
      }

      const halfWidth = assistiveButton.offsetWidth / 2;
      const halfHeight = assistiveButton.offsetHeight / 2;
      const padding = 16;
      const minX = halfWidth + padding;
      const maxX = Math.max(minX, window.innerWidth - halfWidth - padding);
      const minY = halfHeight + padding;
      const maxY = Math.max(minY, window.innerHeight - halfHeight - padding);

      return {
        minX,
        maxX,
        minY,
        maxY,
      };
    };

    const applyAssistiveButtonPosition = () => {
      if (!assistiveButton) return;
      const { offsetWidth, offsetHeight } = assistiveButton;
      assistiveButton.style.left = `${assistiveButtonPosition.x - offsetWidth / 2}px`;
      assistiveButton.style.top = `${assistiveButtonPosition.y - offsetHeight / 2}px`;
      assistiveButton.style.right = 'auto';
      assistiveButton.style.bottom = 'auto';
    };

    const updateAssistiveButtonPosition = (x, y, options = {}) => {
      if (!assistiveButton) return;
      const { updateRest = true } = options;
      const bounds = getAssistiveBoundaries();
      assistiveButtonPosition.x = clamp(x, bounds.minX, bounds.maxX);
      assistiveButtonPosition.y = clamp(y, bounds.minY, bounds.maxY);
      if (updateRest) {
        assistiveButtonRestPosition.x = assistiveButtonPosition.x;
        assistiveButtonRestPosition.y = assistiveButtonPosition.y;
      }
      applyAssistiveButtonPosition();
    };

    const applyPointerMode = () => {
      const coarse = isCoarsePointer();
      document.body.classList.toggle('coarse-pointer', coarse);
      if (!coarse && isMenuOpen) {
        closeRadialMenu();
      }
      syncAssistiveButtonState(coarse);
      if (coarse) {
        updatePointerFromAssistiveButton();
      }
    };

    const openSearchPanel = () => {
      if (!searchPanel) return;
      searchPanel.classList.add('active');
      searchPanel.setAttribute('aria-hidden', 'false');
      scheduleRender();
      if (!searchInput?.value.trim()) {
        showHelperMessage('Escribe el nombre del trabajador para iniciar la búsqueda.');
      }
      ensureWorkerDataset().catch(() => {});
      if (searchInput) {
        setTimeout(() => {
          searchInput.focus({ preventScroll: true });
        }, 160);
      }
    };

    const closeSearchPanel = () => {
      if (!searchPanel || !isSearchPanelOpen()) return;
      searchPanel.classList.remove('active');
      searchPanel.setAttribute('aria-hidden', 'true');
      if (searchInput) {
        searchInput.blur();
      }
    };


    if (coarsePointerQuery?.addEventListener) {
      coarsePointerQuery.addEventListener('change', applyPointerMode);
    } else if (coarsePointerQuery?.addListener) {
      coarsePointerQuery.addListener(applyPointerMode);
    }

    assistiveButton?.addEventListener('click', (event) => {
      if (skipNextAssistiveClick) {
        skipNextAssistiveClick = false;
        event.preventDefault();
        event.stopPropagation();
        return;
      }

      event.preventDefault();
      event.stopPropagation();
      if (!isCoarsePointer()) return;

      const rect = assistiveButton.getBoundingClientRect();
      pointer.x = rect.left + rect.width / 2;
      pointer.y = rect.top + rect.height / 2;
      assistiveButtonRestPosition.x = assistiveButtonPosition.x;
      assistiveButtonRestPosition.y = assistiveButtonPosition.y;

      if (isMenuOpen) {
        closeRadialMenu();
        return;
      }

      setMenuState(true);
    });

    const updatePointerFromAssistiveButton = () => {
      pointer.x = assistiveButtonPosition.x;
      pointer.y = assistiveButtonPosition.y;
      scheduleRender();
    };

    const handleAssistiveButtonPointerDown = (event) => {
      if (!assistiveButton) return;
      event.preventDefault();
      isDraggingAssistiveButton = true;
      didDragAssistiveButton = false;
      assistiveButton.classList.add('is-dragging');
      assistiveButton.setPointerCapture(event.pointerId);
      const rect = assistiveButton.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      assistiveDragOffset.x = event.clientX - centerX;
      assistiveDragOffset.y = event.clientY - centerY;
      assistiveDragStart.x = event.clientX;
      assistiveDragStart.y = event.clientY;
    };

    const handleAssistiveButtonPointerMove = (event) => {
      if (!isDraggingAssistiveButton || !assistiveButton) return;
      event.preventDefault();
      const nextX = event.clientX - assistiveDragOffset.x;
      const nextY = event.clientY - assistiveDragOffset.y;
      updateAssistiveButtonPosition(nextX, nextY);
      if (!didDragAssistiveButton) {
        const deltaX = event.clientX - assistiveDragStart.x;
        const deltaY = event.clientY - assistiveDragStart.y;
        didDragAssistiveButton = Math.hypot(deltaX, deltaY) > 3;
      }
      updatePointerFromAssistiveButton();
    };

    const handleAssistiveButtonPointerUp = (event) => {
      if (!isDraggingAssistiveButton || !assistiveButton) return;
      if (assistiveButton.hasPointerCapture?.(event.pointerId)) {
        assistiveButton.releasePointerCapture(event.pointerId);
      }
      isDraggingAssistiveButton = false;
      assistiveButton.classList.remove('is-dragging');
      if (didDragAssistiveButton) {
        skipNextAssistiveClick = true;
        updatePointerFromAssistiveButton();
      }
      didDragAssistiveButton = false;
    };

    assistiveButton?.addEventListener('pointerdown', handleAssistiveButtonPointerDown);
    assistiveButton?.addEventListener('pointermove', handleAssistiveButtonPointerMove);
    assistiveButton?.addEventListener('pointerup', handleAssistiveButtonPointerUp);
    assistiveButton?.addEventListener('pointercancel', handleAssistiveButtonPointerUp);

    document.addEventListener('mousemove', (event) => {
      pointer.x = event.clientX;
      pointer.y = event.clientY;
      if (!isMenuOpen) {
        scheduleRender();
      }
    });

      document.addEventListener(
      'touchstart',
      (event) => {
        if (!isCoarsePointer()) return;
        const [touch] = event.touches || [];
        if (!touch) return;
        pointer.x = touch.clientX;
        pointer.y = touch.clientY;
        if (!isMenuOpen) {
          scheduleRender();
        }
      },
      { passive: true }
    );
  
    document.addEventListener('contextmenu', (event) => {
      if (isCoarsePointer()) {
        return;
      }
      event.preventDefault();
      pointer.x = event.clientX;
      pointer.y = event.clientY;
      setMenuState(true);
    });

    document.addEventListener('click', (event) => {
      if (isMenuOpen && !radialMenu.contains(event.target)) {
        closeRadialMenu();
      }
  
      if (isSearchPanelOpen() && !searchPanel.contains(event.target)) {
        closeSearchPanel();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        if (isStatusModalOpen()) {
          closeStatusChangeModal();
          return;
        }
        if (isMenuOpen) {
          closeRadialMenu();
        }
        closeSearchPanel();
      }
    });

    window.addEventListener('blur', () => {
      closeStatusChangeModal();
      closeRadialMenu();
      closeSearchPanel();
    });

    window.addEventListener('resize', () => {
      closeRadialMenu();
      applyPointerMode();
      scheduleRender();
      updateAssistiveButtonPosition(assistiveButtonPosition.x, assistiveButtonPosition.y);
      pointer.x = assistiveButtonPosition.x;
      pointer.y = assistiveButtonPosition.y;
    });

    closeSearchPanelButton?.addEventListener('click', (event) => {
      event.preventDefault();
      closeSearchPanel();
    });

    if (searchInput) {
      searchInput.addEventListener('input', (event) => {
        const query = event.target.value;
        if (workerDatasetState.data.length > 0) {
          updateSearchResults(query);
        } else if (!query.trim()) {
          showHelperMessage('Escribe el nombre del trabajador para iniciar la búsqueda.');
        }

        ensureWorkerDataset()
          .then(() => {
            updateSearchResults(query);
          })
          .catch(() => {});
      });

      searchInput.addEventListener('focus', () => {
        ensureWorkerDataset().catch(() => {});
      });
    }

    statusOptionButtons.forEach((button) => {
      button.addEventListener('click', (event) => {
        event.preventDefault();
        const { statusOption } = button.dataset;
        setStatusModalSelection(statusOption);
      });
    });

    statusCancelButton?.addEventListener('click', (event) => {
      event.preventDefault();
      closeStatusChangeModal();
    });

    statusConfirmButton?.addEventListener('click', (event) => {
      event.preventDefault();
      applyStatusChange();
    });

    statusReasonInput?.addEventListener('input', (event) => {
      statusModalState.reason = event.target.value;
      updateStatusConfirmState();
    });

    statusChangeModal?.addEventListener('click', (event) => {
      if (event.target === statusChangeModal) {
        closeStatusChangeModal();
      }
    });

    menuItems.forEach((item) => {
      item.addEventListener('click', (event) => {
        event.stopPropagation();
        const action = item.dataset.action;
        closeRadialMenu();

        if (action === 'buscar-personal') {
          openSearchPanel();
          return;
        }
    
        if (action === 'registrar-personal') {
          window.location.href = 'registro_obrero.html';
          return;
        }

        if (!action) return;

        const label = item.querySelector('.menu-label')?.textContent ?? action;
        const messageBanner = document.createElement('div');
        messageBanner.textContent = `Opción "${label}" seleccionada.`;
        messageBanner.className = 'fixed bottom-8 left-1/2 z-40 -translate-x-1/2 rounded-full bg-emerald-500/90 px-5 py-2 text-sm font-medium text-emerald-950 shadow-lg shadow-emerald-500/40 transition duration-300';
        document.body.appendChild(messageBanner);
        setTimeout(() => {
          messageBanner.classList.add('opacity-0', 'translate-y-3');
        }, 1800);
        setTimeout(() => messageBanner.remove(), 2100);
      });
    });

    if (assistiveButton) {
      const rect = assistiveButton.getBoundingClientRect();
      assistiveButtonPosition.x = rect.left + rect.width / 2;
      assistiveButtonPosition.y = rect.top + rect.height / 2;
      assistiveButtonRestPosition.x = assistiveButtonPosition.x;
      assistiveButtonRestPosition.y = assistiveButtonPosition.y;
      applyAssistiveButtonPosition();
      pointer.x = assistiveButtonPosition.x;
      pointer.y = assistiveButtonPosition.y;
    }

    applyPointerMode();
    scheduleRender();
  </script>
</body>
</html>
